{"uid": "607-D", "url": "https://codeforces.com/contest/607/problem/D", "tags": ["data structures", " trees"], "title": "607-D", "statement": "D. Power Treetime limit per test3.5 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputGenos and Saitama went shopping for Christmas trees. However, a different type of tree caught their attention, the exalted Power Tree.A Power Tree starts out as a single root vertex indexed1. A Power Tree grows through a magical phenomenon known as an update. In anupdate, a single vertex is added to the tree as a child of some other vertex.Every vertex in the tree (the root and all the added vertices) has some valueviassociated with it. Thepowerof a vertex is defined as the strength of the multiset composed of the value associated with this vertex (vi) and thepowersof its direct children. Thestrengthof a multiset is defined as the sum of all elements in themultisetmultiplied by the number of elements in it. Or in other words for somemultisetS:Saitama knows theupdatesthat will be performed on the tree, so he decided to test Genos by asking him queries about the tree during its growth cycle.An update is of the form1pv, and adds a new vertex with valuevas a child of vertexp.A query is of the form2u, and asks for the power of vertexu.Please help Genos respond to these queries modulo109+ 7.InputThe first line of the input contains two space separated integersv1andq(1 ≤v1< 109,1 ≤q≤ 200 000) — the value of vertex1and the total number of updates and queries respectively.The nextqlines contain the updates and queries. Each of them has one of the following forms:1pivi, if these line describes an update. The index of the added vertex is equal to the smallest positive integer not yet used as an index in the tree. It is guaranteed thatpiis some already existing vertex and1 ≤vi< 109.2ui, if these line describes a query. It is guaranteeduiwill exist in the tree.It is guaranteed that the input will contain at least one query.OutputFor each query, print out the power of the given vertex modulo109+ 7.ExamplesInput2 51 1 31 2 51 3 71 4 112 1Output344Input5 51 1 41 2 32 21 2 72 1Output1494NoteFor the first sample case, after all the updates the graph will have vertices labelled in the following manner: 1 — 2 — 3 — 4 — 5These vertices will have corresponding values: 2 — 3 — 5 — 7 — 11And corresponding powers: 344 — 170 — 82 — 36 — 11", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "606728c8", "template_md5": "35d339e4", "result": "You are given a tree data structure that starts with a single vertex labeled 1.  The tree grows by adding new vertices as children of existing vertices. Each vertex has a value associated with it.\n\nThe \"power\" of a vertex is calculated as follows:\n\n1.  Take the set of values of the vertex itself and all its direct children.\n2.  Calculate the sum of all the values in the set.\n3.  Multiply the sum by the number of values in the set.\n\nYou are given a sequence of operations:\n\n* **1 p v:** Add a new vertex with value *v* as a child of vertex *p*.\n* **2 u:**  Calculate and output the power of vertex *u*.\n\n**Input:**\n\n* The first line contains two integers: the value of the initial vertex (v1) and the number of operations (q).\n* The following q lines describe the operations (1 or 2).\n\n**Output:**\n\n* For each query of type 2, output the power of the specified vertex modulo 10^9 + 7."}, {"prompt_md5": "ede758b8", "template_md5": "465699a0", "result": "A tree starts with one node.  Nodes are added to the tree one by one as children of existing nodes. Each node has a value. The \"power\" of a node is the sum of its value and the powers of its children, multiplied by the total number of nodes.  You are given a list of operations:\n\n* **1 p v:** Add a new node with value *v* as a child of node *p*.\n* **2 u:**  Calculate the power of node *u*. \n\nAnswer the power queries."}]}