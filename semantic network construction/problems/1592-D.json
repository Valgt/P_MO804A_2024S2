{"uid": "1592-D", "url": "https://codeforces.com/contest/1592/problem/D", "tags": ["binary search", " dfs and similar", " implementation", " interactive", " math", " number theory", " trees"], "title": "1592-D", "statement": "D. Hemose in ICPC ?time limit per test1 secondmemory limit per test256 megabytesinputstandard inputoutputstandard outputThis is an interactive problem!In the last regional contest Hemose, ZeyadKhattab and YahiaSherif — members of the team Carpe Diem — did not qualify to ICPC because of someunknown reasons. Hemose was very sad and had a bad day after the contest, but ZeyadKhattab is very wise and knows Hemose very well, and does not want to see him sad.Zeyad knows that Hemose loves tree problems, so he gave him a tree problem with a very special device.Hemose has a weighted tree with $$$n$$$ nodes and $$$n-1$$$ edges. Unfortunately, Hemose doesn't remember the weights of edges.Let's define $$$Dist(u, v)$$$ for $$$u\\\\neq v$$$ as the greatest common divisor of the weights of all edges on the path from node $$$u$$$ to node $$$v$$$.Hemose has a special device. Hemose can give the device a set of nodes, and the device will return the largest $$$Dist$$$ between any two nodes from the set. More formally, if Hemose gives the device a set $$$S$$$ of nodes, the device will return the largest value of $$$Dist(u, v)$$$ over all pairs $$$(u, v)$$$ with $$$u$$$, $$$v$$$ $$$\\\\in$$$ $$$S$$$ and $$$u \\\\neq v$$$.Hemose can use this Deviceat most $$$12$$$ times, and wants to find any two distinct nodes $$$a$$$, $$$b$$$, such that $$$Dist(a, b)$$$ is maximum possible. Can you help him?InteractionBegin the interaction from reading a single integer $$$n$$$ ($$$2 \\\\le n \\\\le 10^3$$$) — the number of nodes in the tree.Next, read $$$n-1$$$ lines.The $$$i$$$-th of the next $$$n-1$$$ lines contains two integers $$$u_i$$$ and $$$v_i$$$ ($$$1 \\\\leq u_i, v_i \\\\leq n$$$, $$$u_i\\\\neq v_i$$$), which means that there's an edge between nodes $$$u_i$$$ and $$$v_i$$$.It's guaranteed that weights of edges were $$$\\\\leq 10^9$$$.It is guaranteed that the given graph is a tree.Now you may begin asking queries. To ask a query about a set of $$$k$$$ nodes $$$v_1, v_2, \\\\ldots, v_k$$$ ($$$2 \\\\le k \\\\le n$$$, $$$1 \\\\le v_i \\\\le n$$$, all $$$v_i$$$ are distinct), output:?$$$k$$$ $$$v_1$$$ $$$v_2$$$ $$$\\\\ldots$$$ $$$v_k$$$You will then receive an integer $$$x$$$, the largest $$$Dist(v_i, v_j)$$$ over $$$1 \\\\le i, j \\\\le k$$$ with $$$i \\\\neq j$$$.When you have found $$$a$$$ and $$$b$$$ ($$$1 \\\\le a, b \\\\le n)$$$, $$$a\\\\neq b$$$) such that $$$Dist(a, b)$$$ is the maximum possible, print the answer in the following format:!$$$a$$$ $$$b$$$Outputting answer doesn't count towards the limit of $$$12$$$ queries.If there are several pairs $$$(a, b)$$$ with the same largest $$$Dist(a, b)$$$, you can output any.After printing a query do not forget to output the end of line and flush the output. Otherwise, you will getIdleness limit exceeded. To do this, use:fflush(stdout)orcout.flush()in C++;System.out.flush()in Java;flush(output)in Pascal;stdout.flush()in Python;see the documentation for other languages.HacksTo hack a solution, use the following format.The first line should contain a single integer $$$n$$$ $$$(2 \\\\leq n \\\\le 10^3)$$$ — the number of nodes.The $$$i$$$-th of the next $$$n-1$$$ lines should contain three integers $$$u_i$$$, $$$v_i$$$, $$$w_i$$$ ($$$1 \\\\le u_i, v_i \\\\le n$$$, $$$u_i\\\\ne v_i$$$, $$$1 \\\\le w \\\\le 10^9$$$), which means that there's an edge between nodes $$$u_i$$$ and $$$v_i$$$ with weight $$$w_i$$$.These $$$n-1$$$ edges must form a tree.ExampleInput6 1 2 2 3 2 4 1 5 5 6  10  2  10Output? 6 1 2 3 4 5 6  ? 3 3 1 5  ? 2 1 2  ! 1 2NoteThe tree in the first sample:", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "ef41d48f", "template_md5": "35d339e4", "result": "You are given a tree with $n$ nodes and $n-1$ edges. You don't know the weight of each edge, but you have a special device that can help you.\n\nThe device takes a set of nodes as input and returns the largest greatest common divisor (GCD) of the weights of all edges on the paths between any two distinct nodes in the set.\n\nYou can use the device at most 12 times. Your goal is to find two distinct nodes $a$ and $b$ such that the GCD of the weights of all edges on the path from $a$ to $b$ is as large as possible.\n\n**Input:**\n\n* The first line contains an integer $n$ ($2 \\le n \\le 10^3$), the number of nodes in the tree.\n* The next $n-1$ lines each contain two integers $u_i$ and $v_i$ ($1 \\le u_i, v_i \\le n$, $u_i \\neq v_i$), representing an edge between nodes $u_i$ and $v_i$.\n\n**Output:**\n\nTo ask the device a question, output a line with the following format:\n\n`? $k$ $v_1$ $v_2$ ... $v_k$`\n\nwhere:\n\n* $k$ is the number of nodes in the set (2 ≤ $k$ ≤ $n$)\n* $v_1$, $v_2$, ..., $v_k$ are the nodes in the set (1 ≤ $v_i$ ≤ $n$, all $v_i$ are distinct).\n\nThe device will then output an integer $x$, which is the largest GCD of the weights of all edges on the paths between any two distinct nodes in the set.\n\nOnce you have found two nodes $a$ and $b$ ($1 \\le a, b \\le n$, $a \\neq b$) such that the GCD of the weights of all edges on the path from $a$ to $b$ is as large as possible, output a line in the following format:\n\n`! $a$ $b$`"}, {"prompt_md5": "938d2781", "template_md5": "465699a0", "result": "You are given a tree with a certain number of nodes. You don't know the weight of each edge, but you have a special device that can tell you the largest common divisor of edge weights along any path between a set of given nodes. You can use the device a maximum of 12 times. Your goal is to find two nodes with the largest possible common divisor of edge weights between them."}]}