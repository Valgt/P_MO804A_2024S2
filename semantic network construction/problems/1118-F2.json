{"uid": "1118-F2", "url": "https://codeforces.com/contest/1118/problem/F2", "tags": ["combinatorics", " dfs and similar", " dp", " trees"], "title": "1118-F2", "statement": "F2. Tree Cutting (Hard Version)time limit per test2 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputYou are given an undirected tree of $$$n$$$ vertices.Some vertices are colored one of the $$$k$$$ colors, some are uncolored. It is guaranteed that the tree contains at least one vertex of each of the $$$k$$$ colors. There might be no uncolored vertices.You choose a subset ofexactly $$$k - 1$$$ edgesand remove it from the tree. Tree falls apart into $$$k$$$ connected components. Let's call this subset of edgesniceif none of the resulting components contain vertices of different colors.How manynicesubsets of edges are there in the given tree? Two subsets are considered different if there is some edge that is present in one subset and absent in the other.The answer may be large, so print it modulo $$$998244353$$$.InputThe first line contains two integers $$$n$$$ and $$$k$$$ ($$$2 \\\\le n \\\\le 3 \\\\cdot 10^5$$$, $$$2 \\\\le k \\\\le n$$$) — the number of vertices in the tree and the number of colors, respectively.The second line contains $$$n$$$ integers $$$a_1, a_2, \\\\dots, a_n$$$ ($$$0 \\\\le a_i \\\\le k$$$) — the colors of the vertices. $$$a_i = 0$$$ means that vertex $$$i$$$ is uncolored, any other value means the vertex $$$i$$$ is colored that color.The $$$i$$$-th of the next $$$n - 1$$$ lines contains two integers $$$v_i$$$ and $$$u_i$$$ ($$$1 \\\\le v_i, u_i \\\\le n$$$, $$$v_i \\\\ne u_i$$$) — the edges of the tree. It is guaranteed that the given edges form a tree. It is guaranteed that the tree contains at least one vertex of each of the $$$k$$$ colors. There might be no uncolored vertices.OutputPrint a single integer — the number ofnicesubsets of edges in the given tree. Two subsets are considered different if there is some edge that is present in one subset and absent in the other.The answer may be large, so print it modulo $$$998244353$$$.ExamplesInput5 2 2 0 0 1 2 1 2 2 3 2 4 2 5Output1Input7 3 0 1 0 2 2 3 0 1 3 1 4 1 5 2 7 3 6 4 7Output4NoteHere is the tree from the first example:The onlynicesubset is edge $$$(2, 4)$$$. Removing it makes the tree fall apart into components $$$\\\\{4\\\\}$$$ and $$$\\\\{1, 2, 3, 5\\\\}$$$. The first component only includes a vertex of color $$$1$$$ and the second component includes only vertices of color $$$2$$$ and uncolored vertices.Here is the tree from the second example:Thenicesubsets are $$$\\\\{(1, 3), (4, 7)\\\\}$$$, $$$\\\\{(1, 3), (7, 2)\\\\}$$$, $$$\\\\{(3, 6), (4, 7)\\\\}$$$ and $$$\\\\{(3, 6), (7, 2)\\\\}$$$.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "3c18b045", "template_md5": "465699a0", "result": "You have a tree-shaped network with nodes colored in a few different colors.  You need to remove some edges from the tree to split it into groups where each group only has nodes of a single color.  How many different ways can you do this?"}, {"prompt_md5": "07d0575d", "template_md5": "35d339e4", "result": "You are given a tree with $n$ vertices. Some vertices are colored with one of $k$ colors, and some are uncolored.  \n\nYou need to choose $k-1$ edges to remove from the tree.  This will split the tree into $k$ separate connected components.\n\nA set of edges is considered \"nice\" if no component contains vertices of different colors.\n\nHow many different \"nice\" sets of edges are there?  \n\nThe answer may be very large, so give the answer modulo 998244353. \n\n\n**Input:**\n\n* The first line contains two integers, $n$ and $k$ ($2 \\le n \\le 3 \\cdot 10^5$, $2 \\le k \\le n$).\n* The second line contains $n$ integers, $a_1, a_2, ..., a_n$ ($0 \\le a_i \\le k$).  $a_i = 0$ means vertex $i$ is uncolored, and any other value means vertex $i$ is colored that color.\n* The next $n-1$ lines each contain two integers, $v_i$ and $u_i$ ($1 \\le v_i, u_i \\le n$, $v_i \\ne u_i$), representing the edges of the tree.\n\n**Output:**\n\n* Print a single integer, the number of \"nice\" sets of edges, modulo 998244353."}]}