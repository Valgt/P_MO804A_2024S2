{"uid": "1584-D", "url": "https://codeforces.com/contest/1584/problem/D", "tags": ["binary search", " combinatorics", " interactive", " math"], "title": "1584-D", "statement": "D. Guess the Permutationtime limit per test1 secondmemory limit per test256 megabytesinputstandard inputoutputstandard outputThis is an interactive problem.Jury initially had a sequence $$$a$$$ of length $$$n$$$, such that $$$a_i = i$$$.The jury chose three integers $$$i$$$, $$$j$$$, $$$k$$$, such that $$$1 \\\\leq i < j < k \\\\leq n$$$, $$$j - i > 1$$$. After that, Jury reversed subsegments $$$[i, j - 1]$$$ and $$$[j, k]$$$ of the sequence $$$a$$$.Reversing a subsegment $$$[l, r]$$$ of the sequence $$$a$$$ means reversing the order of elements $$$a_l, a_{l+1}, \\\\ldots, a_r$$$ in the sequence, i. e. $$$a_l$$$ is swapped with $$$a_r$$$, $$$a_{l+1}$$$ is swapped with $$$a_{r-1}$$$, etc.You are given the number $$$n$$$ and you should find $$$i$$$, $$$j$$$, $$$k$$$ after asking some questions.In one question you can choose two integers $$$l$$$ and $$$r$$$ ($$$1 \\\\leq l \\\\leq r \\\\leq n$$$) and ask the number of inversions on the subsegment $$$[l, r]$$$ of the sequence $$$a$$$. You will be given the number of pairs $$$(i, j)$$$ such that $$$l \\\\leq i < j \\\\leq r$$$, and $$$a_i > a_j$$$.Find the chosen numbers $$$i$$$, $$$j$$$, $$$k$$$ after at most $$$40$$$ questions.The numbers $$$i$$$, $$$j$$$, and $$$k$$$ are fixed before the start of your program and do not depend on your queries.InputEach test consists of multiple test cases. The first line contains a single integer $$$t$$$ ($$$1 \\\\leq t \\\\leq 100$$$) — the number of test cases. Description of the test cases follows.The single line of each test case contains a single integer $$$n$$$ ($$$4 \\\\leq n \\\\leq 10^9$$$). After reading it you should start an interaction process by asking questions for that test case. After giving an answer you should:Terminate your program if that is the last test case.Proceed to the next test case otherwise.InteractionTo ask number of inversions on a subsegment $$$[l, r]$$$, print \"? l r\", where ($$$1 \\\\leq l \\\\leq r \\\\leq n$$$). You can ask at most $$$40$$$ questions in each test case. As a result you should read a single integer $$$x$$$.If $$$x = -1$$$, your program made an invalid question or you exceeded the number of questions for that test case. Your program should terminate immediately (otherwise it can get any verdict instead of \"Wrong Answer\").Otherwise $$$x$$$ is equal to the number of inversions on the subsegment $$$[l, r]$$$ of the sequence $$$a$$$.To give the answer, print \"! i j k\", where $$$i$$$, $$$j$$$, $$$k$$$ are the numbers you found. You should continue solving the next test cases or terminate the program after that.After printing a question or an answer do not forget to print the end of line and flush the output. Otherwise, you will get an \"Idleness limit exceeded\" verdict. To do this, use:fflush(stdout)orcout.flush()in C++;System.out.flush()in Java;flush(output)in Pascal;stdout.flush()in Python;See the documentation for other languages.HacksTo make a hack, use the following format:The first line contains a single integer $$$t$$$ ($$$1 \\\\leq t \\\\leq 100$$$) — the number of test cases.Each of the next $$$t$$$ lines contains four integers $$$n$$$, $$$i$$$, $$$j$$$, $$$k$$$ ($$$4 \\\\leq n \\\\leq 10^9$$$, $$$1 \\\\leq i < j < k \\\\leq n$$$, $$$j - i > 1$$$).ExampleInput2  5   4   3   3   5   2   2   1Output? 1 5  ? 2 5  ? 3 5  ! 1 3 5  ? 1 5  ? 2 5  ? 3 5  ! 2 4 5NoteIn the first test case, $$$i = 1$$$, $$$j = 3$$$, $$$k = 5$$$, so the sequence $$$a$$$ is $$$[2, 1, 5, 4, 3]$$$.In the second test case, $$$i = 2$$$, $$$j = 4$$$, $$$k = 5$$$, so the sequence $$$a$$$ is $$$[1, 3, 2, 5, 4]$$$.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "b41d74c9", "template_md5": "35d339e4", "result": "You are given a sequence of numbers from 1 to $n$.  Three numbers $i$, $j$, and $k$ are chosen such that $1 \\le i < j < k \\le n$ and $j-i > 1$.  Then, the subsegments $[i, j-1]$ and $[j, k]$ of the sequence are reversed.\n\nYour goal is to find the values of $i$, $j$, and $k$ by asking questions about the sequence.  You can ask a question by specifying two numbers $l$ and $r$ ($1 \\le l \\le r \\le n$) and asking for the number of inversions in the subsegment $[l, r]$. An inversion is a pair of numbers $(i, j)$ where $l \\le i < j \\le r$ and $a_i > a_j$.\n\nYou are allowed to ask at most 40 questions per test case. \n\n\nAfter finding $i$, $j$, and $k$, you should output them as \"! i j k\"."}, {"prompt_md5": "cc034059", "template_md5": "465699a0", "result": "You are given a sequence of numbers. Three numbers were chosen from the sequence, and two parts of the sequence were reversed. Your goal is to find the three chosen numbers by asking questions about the number of \"inversions\" in different parts of the sequence. An inversion is a pair of numbers where the first number is larger than the second number. You can ask up to 40 questions to find the answer."}]}