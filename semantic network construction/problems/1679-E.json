{"uid": "1679-E", "url": "https://codeforces.com/contest/1679/problem/E", "tags": ["bitmasks", " combinatorics", " dp", " strings"], "title": "1679-E", "statement": "E. Typical Party in Dormtime limit per test2 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputToday is a holiday in the residence hall — Oleh arrived, in honor of which the girls gave him a string. Oleh liked the gift a lot, so he immediately thought up and offered you, his best friend, the following problem.You are given a string $$$s$$$ of length $$$n$$$, which consists of the first $$$17$$$ lowercase Latin letters {$$$a$$$, $$$b$$$, $$$c$$$, $$$\\\\ldots$$$, $$$p$$$, $$$q$$$} and question marks. And $$$q$$$ queries. Each query is defined by a set of pairwise distinct lowercase first $$$17$$$ letters of the Latin alphabet, which can be used to replace the question marks in the string $$$s$$$.The answer to the query is the sum of the number of distinct substrings that are palindromes over all strings that can be obtained from the original string $$$s$$$ by replacing question marks with available characters. The answer must be calculated modulo $$$998\\\\,244\\\\,353$$$.Pay attention!Two substrings are different when their start and end positions in the string are different. So, the number of different substrings that are palindromes for the stringabawill be $$$4$$$:a,b,a,aba.Consider examples of replacing question marks with letters. For example, from the stringaba??eewhen querying {$$$a$$$, $$$b$$$} you can get the stringsababaeeorabaaaeebut you cannot get the stringspizza,abaee,abacaba,aba?fee,aba47ee, orabatree.Recall that a palindrome is a string that reads the same from left to right as from right to left.InputThe first line contains a single integer $$$n$$$ ($$$1 \\\\le n \\\\le 1\\\\,000$$$) — the length of the string $$$s$$$.The second line contains the string $$$s$$$, which consists of $$$n$$$ lowercase Latin letters and question marks. It is guaranteed that all letters in the string belong to the set {$$$a$$$, $$$b$$$, $$$c$$$, $$$\\\\ldots$$$, $$$p$$$, $$$q$$$}.The third line contains a single integer $$$q$$$ ($$$1 \\\\le q \\\\le 2 \\\\cdot 10^5$$$) — the number of queries.This is followed by $$$q$$$ lines, each containing a single line $$$t$$$ — a set of characters that can replace question marks ($$$1 \\\\le |t| \\\\le 17$$$). It is guaranteed that all letters in the string belong to the set {$$$a$$$, $$$b$$$, $$$c$$$, $$$\\\\ldots$$$, $$$p$$$, $$$q$$$} and occur at most once.OutputFor each query print one number — the total numbers of palindromic substrings in all strings that can be obtained from the string $$$s$$$, modulo $$$998\\\\,244\\\\,353$$$.ExamplesInput7 ab??aba 8 a b ab abc abcd abcde abcdef abcdefgOutput14 13 55 105 171 253 351 465Input11 ??????????? 6 abcdefghijklmnopq ecpnkhbmlidgfjao olehfan codef glhf qOutput900057460 712815817 839861037 756843750 70840320 66NoteConsider the first example and the first query in it. We can get only one string as a result of replacing the question marks  —abaaaba. It has the following palindrome substrings:a— substring [$$$1$$$; $$$1$$$].b— substring [$$$2$$$; $$$2$$$].a— substring [$$$3$$$; $$$3$$$].a— substring [$$$4$$$; $$$4$$$].a— substring [$$$5$$$; $$$5$$$].b— substring [$$$6$$$; $$$6$$$].a— substring [$$$7$$$; $$$7$$$].aa— substring [$$$3$$$; $$$4$$$].aa— substring [$$$4$$$; $$$5$$$].aba— substring [$$$1$$$; $$$3$$$].aaa— substring [$$$3$$$; $$$5$$$].aba— substring [$$$5$$$; $$$7$$$].baaab— substring [$$$2$$$; $$$6$$$].abaaaba— substring [$$$1$$$; $$$7$$$].In the third request, we get 4 lines:abaaaba,abababa,abbaaba,abbbaba.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "b0cb0b0a", "template_md5": "465699a0", "result": "You are given a string with some question marks. You will be given sets of letters to replace the question marks. For each set, count the total number of unique palindromic substrings you can create by replacing the question marks.  The answer should be calculated modulo 998244353."}, {"prompt_md5": "5dfca83b", "template_md5": "35d339e4", "result": "You are given a string of length $n$ consisting of lowercase letters and question marks. You are also given $q$ queries. Each query consists of a set of lowercase letters that can be used to replace the question marks in the string.\n\nFor each query, find the total number of distinct palindromic substrings in all possible strings that can be formed by replacing the question marks with the letters in the query set. The answer must be calculated modulo $998244353$.\n\n**Input:**\n\n* The first line contains an integer $n$ ($1 \\le n \\le 1000$) - the length of the string.\n* The second line contains the string.\n* The third line contains an integer $q$ ($1 \\le q \\le 2 \\cdot 10^5$) - the number of queries.\n* Each of the next $q$ lines contains a set of letters that can replace the question marks.\n\n**Output:**\n\nFor each query, print the total number of palindromic substrings modulo $998244353$."}]}