{"uid": "1491-H", "url": "https://codeforces.com/contest/1491/problem/H", "tags": ["data structures", " trees"], "title": "1491-H", "statement": "H. Yuezheng Ling and Dynamic Treetime limit per test1.5 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputYuezheng Ling gives Luo Tianyi a tree which has $$$n$$$ nodes, rooted at $$$1$$$.Luo Tianyi will tell you that the parent of the $$$i$$$-th node is $$$a_i$$$ ($$$1 \\\\leq a_i<i$$$ for $$$2 \\\\le i \\\\le n$$$), and she will ask you to perform $$$q$$$ queries of $$$2$$$ types:She'll give you three integers $$$l$$$, $$$r$$$ and $$$x$$$ ($$$2 \\\\le l \\\\le r \\\\le n$$$, $$$1 \\\\le x \\\\le 10^5$$$). You need to replace $$$a_i$$$ with $$$\\\\max(a_i-x,1)$$$ for all $$$i$$$ with $$$l \\\\leq i \\\\leq r$$$.She'll give you two integers $$$u$$$, $$$v$$$ ($$$1 \\\\le u, v \\\\le n$$$). You need to find theLCAof nodes $$$u$$$ and $$$v$$$ (their lowest common ancestor).InputThe first line contains two integers $$$n$$$ and $$$q$$$ ($$$2\\\\leq n,q \\\\leq 10^5$$$) — the number of nodes and the number of queries, respectively.The second line contains $$$n-1$$$ integers $$$a_2, a_3,\\\\dots, a_n$$$ ($$$1 \\\\le a_i < i$$$), where $$$a_i$$$ is the parent of the node $$$i$$$.Next $$$q$$$ lines contain queries. For each query, the first integer of each line is $$$t$$$ ($$$t = 1$$$ or $$$2$$$) — the type of the query.If $$$t = 1$$$, this represents the query of the first type. Then, three integers will follow: $$$l$$$, $$$r$$$, $$$x$$$ ($$$2 \\\\le l \\\\le r \\\\le n$$$, $$$1 \\\\le x \\\\le 10^5$$$), meaning that you have to replace $$$a_i$$$ with $$$\\\\max(a_i-x,1)$$$ for all $$$i$$$ with $$$l \\\\leq i \\\\leq r$$$.If $$$t = 2$$$, this represents the query of the second type. Then, two integers will follow: $$$u$$$ and $$$v$$$ ($$$1 \\\\le u, v \\\\le n$$$), and you have to find the LCA of $$$u$$$ and $$$v$$$.It's guaranteed that there is at least one query of the second type.OutputFor each query of the second type output answer on a new line.ExampleInput6 4 1 2 3 3 4 2 3 4 1 2 3 1 2 5 6 2 2 3Output3 3 1NoteThe tree in example is shown below.After the query of the first type, the tree changes and is looking as shown below.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "15dfabe1", "template_md5": "35d339e4", "result": "You are given a tree with $n$ nodes, rooted at node 1.  The parent of node $i$ is given by $a_i$ ($2 \\le i \\le n$).\n\nYou will be asked $q$ queries of two types:\n\n**Type 1:**\n\n* You are given three integers $l$, $r$, and $x$ ($2 \\le l \\le r \\le n$, $1 \\le x \\le 10^5$).\n* For all nodes $i$ where $l \\le i \\le r$, update the parent of node $i$ to be $\\max(a_i - x, 1)$.\n\n**Type 2:**\n\n* You are given two integers $u$ and $v$ ($1 \\le u, v \\le n$).\n* Find the Lowest Common Ancestor (LCA) of nodes $u$ and $v$.\n\n**Input:**\n\n* The first line contains two integers $n$ and $q$ ($2 \\le n, q \\le 10^5$) - the number of nodes and the number of queries, respectively.\n* The second line contains $n-1$ integers $a_2, a_3, ..., a_n$ ($1 \\le a_i < i$), where $a_i$ is the parent of node $i$.\n* The next $q$ lines contain queries. Each query starts with an integer $t$ ($t = 1$ or $2$) indicating the type of query.\n    * If $t = 1$, the query is of type 1 and contains three integers $l$, $r$, and $x$.\n    * If $t = 2$, the query is of type 2 and contains two integers $u$ and $v$.\n\n**Output:**\n\n* For each query of type 2, output the LCA of nodes $u$ and $v$ on a new line."}, {"prompt_md5": "6f75a880", "template_md5": "465699a0", "result": "You are given a tree with $n$ nodes. You need to perform $q$ operations. \n\nThere are two types of operations:\n\n1. **Update:** Change the parent of nodes from $l$ to $r$ to be the maximum of their current parent minus a value $x$, or 1.\n2. **Find LCA:** Find the lowest common ancestor of two nodes $u$ and $v$."}]}