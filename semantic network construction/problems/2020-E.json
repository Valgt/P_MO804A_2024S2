{"uid": "2020-E", "url": "https://codeforces.com/contest/2020/problem/E", "tags": ["bitmasks", " dp", " math", " probabilities"], "title": "2020-E", "statement": "E. Expected Powertime limit per test4 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputYou are given an array of $$$n$$$ integers $$$a_1,a_2,\\\\ldots,a_n$$$. You are also given an array $$$p_1, p_2, \\\\ldots, p_n$$$.Let $$$S$$$ denote the randommultiset(i.Â e., it may contain equal elements) constructed as follows:Initially, $$$S$$$ is empty.For each $$$i$$$ from $$$1$$$ to $$$n$$$, insert $$$a_i$$$ into $$$S$$$ with probability $$$\\\\frac{p_i}{10^4}$$$. Note that each element is inserted independently.Denote $$$f(S)$$$ as thebitwise XORof all elements of $$$S$$$. Please calculate the expected value of $$$(f(S))^2$$$. Output the answer modulo $$$10^9 + 7$$$.Formally, let $$$M = 10^9 + 7$$$. It can be shown that the answer can be expressed as an irreducible fraction $$$\\\\frac{p}{q}$$$, where $$$p$$$ and $$$q$$$ are integers and $$$q \\\\not \\\\equiv 0 \\\\pmod{M}$$$. Output the integer equal to $$$p \\\\cdot q^{-1} \\\\bmod M$$$. In other words, output such an integer $$$x$$$ that $$$0 \\\\le x < M$$$ and $$$x \\\\cdot q \\\\equiv p \\\\pmod{M}$$$.InputEach test contains multiple test cases. The first line contains the number of test cases $$$t$$$ ($$$1 \\\\le t \\\\le 10^4$$$). The description of the test cases follows.The first line of each test case contains a single integer $$$n$$$ ($$$1 \\\\le n \\\\le 2 \\\\cdot 10^5$$$).The second line of each test case contains $$$n$$$ integers $$$a_1,a_2,\\\\ldots,a_n$$$ ($$$1 \\\\le a_i \\\\le 1023$$$).The third line of each test case contains $$$n$$$ integers $$$p_1,p_2,\\\\ldots,p_n$$$ ($$$1 \\\\le p_i \\\\le 10^4$$$).It is guaranteed that the sum of $$$n$$$ over all test cases does not exceed $$$2 \\\\cdot 10^5$$$.OutputFor each test case, output the expected value of $$$(f(S))^2$$$, modulo $$$10^9 + 7$$$.ExampleInput421 25000 500021 11000 20006343 624 675 451 902 8206536 5326 7648 2165 9430 54281110000Output500000007 820000006 280120536 1NoteIn the first test case, $$$a = [1, 2]$$$ and each element is inserted into $$$S$$$ with probability $$$\\\\frac{1}{2}$$$, since $$$p_1 = p_2 = 5000$$$ and $$$\\\\frac{p_i}{10^4} = \\\\frac{1}{2}$$$. Thus, there are $$$4$$$ outcomes for $$$S$$$, each happening with the same probability of $$$\\\\frac{1}{4}$$$:$$$S = \\\\varnothing$$$. In this case, $$$f(S) = 0$$$, $$$(f(S))^2 = 0$$$.$$$S = \\\\{1\\\\}$$$. In this case, $$$f(S) = 1$$$, $$$(f(S))^2 = 1$$$.$$$S = \\\\{2\\\\}$$$. In this case, $$$f(S) = 2$$$, $$$(f(S))^2 = 4$$$.$$$S = \\\\{1,2\\\\}$$$. In this case, $$$f(S) = 1 \\\\oplus 2 = 3$$$, $$$(f(S))^2 = 9$$$.Hence, the answer is $$$0 \\\\cdot \\\\frac{1}{4} + 1 \\\\cdot \\\\frac{1}{4} + 4\\\\cdot \\\\frac{1}{4} + 9 \\\\cdot \\\\frac{1}{4} = \\\\frac{14}{4} = \\\\frac{7}{2} \\\\equiv 500\\\\,000\\\\,007 \\\\pmod{10^9 + 7}$$$.In the second test case, $$$a = [1, 1]$$$, $$$a_1$$$ is inserted into $$$S$$$ with probability $$$0.1$$$, while $$$a_2$$$ is inserted into $$$S$$$ with probability $$$0.2$$$. There are $$$3$$$ outcomes for $$$S$$$:$$$S = \\\\varnothing$$$. In this case, $$$f(S) = 0$$$, $$$(f(S))^2 = 0$$$. This happens with probability $$$(1-0.1) \\\\cdot (1-0.2) = 0.72$$$.$$$S = \\\\{1\\\\}$$$. In this case, $$$f(S) = 1$$$, $$$(f(S))^2 = 1$$$. This happens with probability $$$(1-0.1) \\\\cdot 0.2 + 0.1 \\\\cdot (1-0.2) = 0.26$$$.$$$S = \\\\{1, 1\\\\}$$$. In this case, $$$f(S) = 0$$$, $$$(f(S))^2 = 0$$$. This happens with probability $$$0.1 \\\\cdot 0.2 = 0.02$$$.Hence, the answer is $$$0 \\\\cdot 0.72 + 1 \\\\cdot 0.26 + 0 \\\\cdot 0.02 = 0.26 = \\\\frac{26}{100} \\\\equiv 820\\\\,000\\\\,006 \\\\pmod{10^9 + 7}$$$.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "225f0ec6", "template_md5": "35d339e4", "result": "You are given two arrays,  $a$ and $p$, of length $n$.  \n\n* Array $a$ contains $n$ integers, $a_1, a_2, ..., a_n$.\n* Array $p$ contains $n$ integers, $p_1, p_2, ..., p_n$.\n\nImagine a random set $S$ is created as follows:\n\n1. Start with an empty set $S$.\n2. For each integer $i$ from 1 to $n$:\n   * Add $a_i$ to set $S$ with a probability of $\\frac{p_i}{10000}$.\n\nThe bitwise XOR of all the elements in set $S$ is denoted as $f(S)$.\n\nCalculate the expected value of $(f(S))^2$ modulo $10^9 + 7$. \n\n**Important:**\n\n* The probability of adding each element to the set is independent of the others.\n* The set $S$ can contain duplicate elements.\n*  $M = 10^9 + 7$. The answer can be expressed as a fraction $\\frac{p}{q}$ where $q \\neq 0 \\pmod{M}$. Output the integer $x$ such that $0 \\le x < M$ and $x \\cdot q \\equiv p \\pmod{M}$."}, {"prompt_md5": "ed98a381", "template_md5": "465699a0", "result": "You are given two arrays of numbers. The first array represents a set of values, and the second array represents the probabilities of each value being included in a random collection. Calculate the expected value of the square of the bitwise XOR of all the values in the random collection."}]}