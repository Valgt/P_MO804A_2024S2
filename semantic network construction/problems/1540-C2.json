{"uid": "1540-C2", "url": "https://codeforces.com/contest/1540/problem/C2", "tags": ["dp", " math"], "title": "1540-C2", "statement": "C2. Converging Array (Hard Version)time limit per test5 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputThis is the hard version of the problem. The only difference is that in this version $$$1 \\\\le q \\\\le 10^5$$$. You can make hacks only if both versions of the problem are solved.There is a process that takes place on arrays $$$a$$$ and $$$b$$$ of length $$$n$$$ and length $$$n-1$$$ respectively.The process is an infinite sequence of operations. Each operation is as follows:First, choose a random integer $$$i$$$ ($$$1 \\\\le i \\\\le n-1$$$).Then, simultaneously set $$$a_i = \\\\min\\\\left(a_i, \\\\frac{a_i+a_{i+1}-b_i}{2}\\\\right)$$$ and $$$a_{i+1} = \\\\max\\\\left(a_{i+1}, \\\\frac{a_i+a_{i+1}+b_i}{2}\\\\right)$$$ without any rounding (so values may become non-integer).See notes for an example of an operation.It can be proven that array $$$a$$$ converges, i. e. for each $$$i$$$ there exists a limit $$$a_i$$$ converges to. Let function $$$F(a, b)$$$ return the value $$$a_1$$$ converges to after a process on $$$a$$$ and $$$b$$$.You are given array $$$b$$$, but not array $$$a$$$. However, you are given a third array $$$c$$$. Array $$$a$$$ is good if it contains onlyintegersand satisfies $$$0 \\\\leq a_i \\\\leq c_i$$$ for $$$1 \\\\leq i \\\\leq n$$$.Your task is to count the number of good arrays $$$a$$$ where $$$F(a, b) \\\\geq x$$$ for $$$q$$$ values of $$$x$$$. Since the number of arrays can be very large, print it modulo $$$10^9+7$$$.InputThe first line contains a single integer $$$n$$$ ($$$2 \\\\le n \\\\le 100$$$).The second line contains $$$n$$$ integers $$$c_1, c_2 \\\\ldots, c_n$$$ ($$$0 \\\\le c_i \\\\le 100$$$).The third line contains $$$n-1$$$ integers $$$b_1, b_2, \\\\ldots, b_{n-1}$$$ ($$$0 \\\\le b_i \\\\le 100$$$).The fourth line contains a single integer $$$q$$$ ($$$1 \\\\le q \\\\le 10^5$$$).The fifth line contains $$$q$$$ space separated integers $$$x_1, x_2, \\\\ldots, x_q$$$ ($$$-10^5 \\\\le x_i \\\\le 10^5$$$).OutputOutput $$$q$$$ integers, where the $$$i$$$-th integer is the answer to the $$$i$$$-th query, i. e. the number of good arrays $$$a$$$ where $$$F(a, b) \\\\geq x_i$$$ modulo $$$10^9+7$$$.ExampleInput3 2 3 4 2 1 5 -1 0 1 -100000 100000Output56 28 4 60 0NoteThe following explanation assumes $$$b = [2, 1]$$$ and $$$c=[2, 3, 4]$$$ (as in the sample).Examples of arrays $$$a$$$ that arenotgood:$$$a = [3, 2, 3]$$$ is not good because $$$a_1 > c_1$$$;$$$a = [0, -1, 3]$$$ is not good because $$$a_2 < 0$$$.One possible good array $$$a$$$ is $$$[0, 2, 4]$$$. We can show that no operation has any effect on this array, so $$$F(a, b) = a_1 = 0$$$.Another possible good array $$$a$$$ is $$$[0, 1, 4]$$$. In a single operation with $$$i = 1$$$, we set $$$a_1 = \\\\min(\\\\frac{0+1-2}{2}, 0)$$$ and $$$a_2 = \\\\max(\\\\frac{0+1+2}{2}, 1)$$$. So, after a single operation with $$$i = 1$$$, $$$a$$$ becomes equal to $$$[-\\\\frac{1}{2}, \\\\frac{3}{2}, 4]$$$. We can show that no operation has any effect on this array, so $$$F(a, b) = -\\\\frac{1}{2}$$$.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "b4539cd3", "template_md5": "35d339e4", "result": "You are given two arrays,  $a$ and $b$, with lengths $n$ and $n-1$ respectively.  There is a process that repeatedly modifies array $a$ as follows:\n\n1. Choose a random integer $i$ between 1 and $n-1$.\n2. Update $a_i$ to be the minimum of its current value and $\\frac{a_i + a_{i+1} - b_i}{2}$.\n3. Update $a_{i+1}$ to be the maximum of its current value and $\\frac{a_i + a_{i+1} + b_i}{2}$.\n\nThis process continues infinitely.\n\nYou are also given a third array $c$ of length $n$.  An array $a$ is considered \"good\" if:\n\n* All elements of $a$ are integers.\n* $0 \\le a_i \\le c_i$ for all $i$ from 1 to $n$.\n\nLet $F(a, b)$ represent the value that $a_1$ converges to after this process is applied to $a$ and $b$.\n\nYour task is to determine the number of good arrays $a$ for which $F(a, b) \\ge x$, for $q$ given values of $x$.  Since the number of arrays can be very large, output the count modulo $10^9 + 7$.\n\n\n\nLet me know if you'd like me to elaborate on any part of the problem statement."}, {"prompt_md5": "ebd9ccec", "template_md5": "465699a0", "result": "You are given two arrays, `b` and `c`.  You need to find the number of arrays `a` that meet these conditions:\n\n* `a` has integers only.\n* Each element in `a` is less than or equal to the corresponding element in `c`.\n* After a special process is applied repeatedly to `a` and `b`, the first element of `a` is greater than or equal to a given target value `x`.\n\nThe process involves swapping and adjusting elements in `a` based on the values in `b`. You need to do this for multiple target values `x`."}]}