{"uid": "1227-F2", "url": "https://codeforces.com/contest/1227/problem/F2", "tags": ["combinatorics", " math"], "title": "1227-F2", "statement": "F2. Wrong Answer on test 233 (Hard Version)time limit per test1 secondmemory limit per test256 megabytesinputstandard inputoutputstandard outputYour program fails again. This time it gets \"Wrong answer on test 233\".This is the harder version of the problem. In this version, $$$1 \\\\le n \\\\le 2\\\\cdot10^5$$$. You can hack this problem if you locked it. But you can hack the previous problem only if you locked both problems.The problem is to finish $$$n$$$ one-choice-questions. Each of the questions contains $$$k$$$ options, and only one of them is correct. The answer to the $$$i$$$-th question is $$$h_{i}$$$, and if your answer of the question $$$i$$$ is $$$h_{i}$$$, you earn $$$1$$$ point, otherwise, you earn $$$0$$$ points for this question. The values $$$h_1, h_2, \\\\dots, h_n$$$ are known to you in this problem.However, you have a mistake in your program. It moves the answer clockwise! Consider all the $$$n$$$ answers are written in a circle. Due to the mistake in your program, they are shifted by one cyclically.Formally, the mistake moves the answer for the question $$$i$$$ to the question $$$i \\\\bmod n + 1$$$. So it moves the answer for the question $$$1$$$ to question $$$2$$$, the answer for the question $$$2$$$ to the question $$$3$$$, ..., the answer for the question $$$n$$$ to the question $$$1$$$.We call all the $$$n$$$ answers together ananswer suit. There are $$$k^n$$$ possible answer suits in total.You're wondering, how many answer suits satisfy the following condition:after moving clockwise by $$$1$$$, the total number of points of the new answer suit is strictly larger than the number of points of the old one. You need to find the answer modulo $$$998\\\\,244\\\\,353$$$.For example, if $$$n = 5$$$, and your answer suit is $$$a=[1,2,3,4,5]$$$, it will submitted as $$$a'=[5,1,2,3,4]$$$ because of a mistake. If the correct answer suit is $$$h=[5,2,2,3,4]$$$, the answer suit $$$a$$$ earns $$$1$$$ point and the answer suite $$$a'$$$ earns $$$4$$$ points. Since $$$4 > 1$$$, the answer suit $$$a=[1,2,3,4,5]$$$ should be counted.InputThe first line contains two integers $$$n$$$, $$$k$$$ ($$$1 \\\\le n \\\\le 2\\\\cdot10^5$$$, $$$1 \\\\le k \\\\le 10^9$$$) — the number of questions and the number of possible answers to each question.The following line contains $$$n$$$ integers $$$h_1, h_2, \\\\dots, h_n$$$, ($$$1 \\\\le h_{i} \\\\le k)$$$ — answers to the questions.OutputOutput one integer: the number of answers suits satisfying the given condition, modulo $$$998\\\\,244\\\\,353$$$.ExamplesInput3 3 1 3 1Output9Input5 5 1 1 4 2 2Output1000Input6 2 1 1 2 2 1 1Output16NoteFor the first example, valid answer suits are $$$[2,1,1], [2,1,2], [2,1,3], [3,1,1], [3,1,2], [3,1,3], [3,2,1], [3,2,2], [3,2,3]$$$.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "4a612ce2", "template_md5": "35d339e4", "result": "You are given $n$ questions, each with $k$ possible answers.  You know the correct answer to each question ($h_1, h_2, ..., h_n$).\n\nHowever, your program makes a mistake: it shifts the answer for each question one position clockwise. For example, if the correct answer to question 1 is 2, your program will submit answer 3.\n\nYou need to find how many sets of answers (called \"answer suits\") exist where, after the clockwise shift, the total number of correct answers is strictly greater than the total number of correct answers in the original set.\n\nThe total number of possible answer suits is $k^n$.  \n\nOutput the number of valid answer suits modulo 998244353."}, {"prompt_md5": "b7772f70", "template_md5": "465699a0", "result": "You have a sequence of  'n' questions, each with 'k' possible answers. You know the correct answer for each question.  Your program makes a mistake that shifts each answer one position to the right in a circular fashion.  \n\nCount how many sequences of answers would result in a higher score after the shift compared to the original sequence.  The score for a sequence is the number of correct answers.  The answer should be given modulo 998244353."}]}