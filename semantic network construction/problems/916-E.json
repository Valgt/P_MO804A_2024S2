{"uid": "916-E", "url": "https://codeforces.com/contest/916/problem/E", "tags": ["data structures", " trees"], "title": "916-E", "statement": "E. Jamie and Treetime limit per test2.5 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputTo your surprise, Jamie is the final boss! Ehehehe.Jamie has given you a tree withnvertices, numbered from1ton. Initially, the root of the tree is the vertex with number1. Also, each vertex has a value on it.Jamie also gives you three types of queries on the tree:1v— Change the tree's root to vertex with numberv.2uvx— For each vertex in the subtree of smallest size that containsuandv, addxto its value.3v— Find sum of values of vertices in the subtree of vertex with numberv.A subtree of vertexvis a set of vertices such thatvlies on shortest path from this vertex to root of the tree. Pay attention that subtree of a vertex can change after changing the tree's root.Show your strength in programming to Jamie by performing the queries accurately!InputThe first line of input contains two space-separated integersnandq(1 ≤n≤ 105, 1 ≤q≤ 105) — the number of vertices in the tree and the number of queries to process respectively.The second line containsnspace-separated integersa1,a2, ...,an(- 108≤ai≤ 108) — initial values of the vertices.Nextn- 1lines contains two space-separated integersui,vi(1 ≤ui,vi≤n) describing edge between verticesuiandviin the tree.The followingqlines describe the queries.Each query has one of following formats depending on its type:1v(1 ≤v≤n) for queries of the first type.2uvx(1 ≤u,v≤n,  - 108≤x≤ 108) for queries of the second type.3v(1 ≤v≤n) for queries of the third type.All numbers in queries' descriptions are integers.The queries must be carried out in the given order. It is guaranteed that the tree is valid.OutputFor each query of the third type, output the required answer. It is guaranteed that at least one query of the third type is given by Jamie.ExamplesInput6 71 4 2 8 5 71 23 14 34 53 63 12 4 6 33 41 62 2 4 -51 43 3Output27195Input4 64 3 5 61 22 33 43 11 32 2 4 31 12 2 4 -33 1Output1821NoteThe following picture shows how the tree varies after the queries in the first sample.", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "95037f27", "template_md5": "35d339e4", "result": "You are given a tree with $n$ vertices, numbered from 1 to $n$. Each vertex has a value associated with it. \n\nThere are three types of queries:\n\n1. **Change Root:** Change the root of the tree to vertex $v$.\n2. **Add to Subtree:** For each vertex in the smallest subtree containing vertices $u$ and $v$, add $x$ to its value.\n3. **Sum Subtree:** Find the sum of values of vertices in the subtree of vertex $v$.\n\nThe subtree of a vertex $v$ is the set of vertices that lie on the shortest path from $v$ to the root of the tree. Note that the subtree of a vertex can change after changing the root.\n\n**Input:**\n\n* The first line contains two integers, $n$ and $q$, representing the number of vertices and the number of queries, respectively.\n* The second line contains $n$ integers, $a_1, a_2, ..., a_n$, representing the initial values of the vertices.\n* The next $n-1$ lines describe the edges of the tree, each line containing two integers $u_i$ and $v_i$, representing an edge between vertices $u_i$ and $v_i$.\n* The following $q$ lines describe the queries. Each query is in one of the following formats:\n    * `1 v` for a Change Root query.\n    * `2 u v x` for an Add to Subtree query.\n    * `3 v` for a Sum Subtree query.\n\n**Output:**\n\nFor each Sum Subtree query, output the required answer."}, {"prompt_md5": "eab93b6f", "template_md5": "465699a0", "result": "You are given a tree with nodes and values. You can change the root of the tree. You can also add a value to all nodes in a specific subtree. Finally, you need to find the sum of values in a subtree."}]}