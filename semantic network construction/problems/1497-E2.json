{"uid": "1497-E2", "url": "https://codeforces.com/contest/1497/problem/E2", "tags": ["data structures", " dp", " greedy", " math", " number theory", " two pointers"], "title": "1497-E2", "statement": "E2. Square-Free Division (hard version)time limit per test2 secondsmemory limit per test256 megabytesinputstandard inputoutputstandard outputThis is the hard version of the problem. The only difference is that in this version $$$0 \\\\leq k \\\\leq 20$$$.There is an array $$$a_1, a_2, \\\\ldots, a_n$$$ of $$$n$$$ positive integers. You should divide it into a minimal number of continuous segments, such that in each segment there are no two numbers (on different positions), whose product is a perfect square.Moreover, it is allowed to do at most $$$k$$$ such operations before the division: choose a number in the array and change its value to any positive integer.What is the minimum number of continuous segments you should use if you will make changes optimally?InputThe first line contains a single integer $$$t$$$ $$$(1 \\\\le t \\\\le 1000)$$$  — the number of test cases.The first line of each test case contains two integers $$$n$$$, $$$k$$$ ($$$1 \\\\le n \\\\le 2 \\\\cdot 10^5$$$, $$$0 \\\\leq k \\\\leq 20$$$).The second line of each test case contains $$$n$$$ integers $$$a_1, a_2, \\\\ldots, a_n$$$ ($$$1 \\\\le a_i \\\\le 10^7$$$).It's guaranteed that the sum of $$$n$$$ over all test cases does not exceed $$$2 \\\\cdot 10^5$$$.OutputFor each test case print a single integer  — the answer to the problem.ExampleInput35 218 6 2 4 111 46 2 2 8 9 1 3 6 3 9 71 01Output1 2 1NoteIn the first test case it is possible to change the array this way: $$$[\\\\underline{3}, 6, 2, 4, \\\\underline{5}]$$$ (changed elements are underlined). After that the array does not need to be divided, so the answer is $$$1$$$.In the second test case it is possible to change the array this way: $$$[6, 2, \\\\underline{3}, 8, 9, \\\\underline{5}, 3, 6, \\\\underline{10}, \\\\underline{11}, 7]$$$. After that such division is optimal:$$$[6, 2, 3]$$$$$$[8, 9, 5, 3, 6, 10, 11, 7]$$$", "source": "CF", "vjudge": false, "processed": [{"prompt_md5": "d00aedaa", "template_md5": "35d339e4", "result": "You are given an array of $n$ positive integers $a_1, a_2, ..., a_n$. You need to divide this array into the fewest possible continuous segments.  \n\nThe only rule is that within each segment, no two numbers can multiply to a perfect square.\n\nYou are allowed to change the value of at most $k$ numbers in the array to any positive integer before dividing it.\n\nFind the minimum number of segments you can create after making these changes.\n\n**Input:**\n\n* The first line contains $t$ (the number of test cases).\n* For each test case:\n    * The first line contains two integers $n$ and $k$ ($1 \\le n \\le 2 \\cdot 10^5$, $0 \\le k \\le 20$).\n    * The second line contains $n$ integers $a_1, a_2, ..., a_n$ ($1 \\le a_i \\le 10^7$).\n\n**Output:**\n\nFor each test case, print a single integer representing the minimum number of segments."}, {"prompt_md5": "d9ebade0", "template_md5": "465699a0", "result": "You are given a list of numbers. You can change some of the numbers a limited number of times.  The goal is to divide the list into groups of numbers where no two numbers in a group multiply to a perfect square. Find the smallest number of groups you can make."}]}